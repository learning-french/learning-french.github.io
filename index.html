<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French A1 | Nina KHARAZISVILI</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-main: #0f172a;
            --bg-side: #1e293b;
            --accent: #38bdf8;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --hover: #334155;
            --glass: rgba(30, 41, 59, 0.7);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        aside {
            width: 320px;
            background: var(--bg-side);
            display: flex;
            flex-direction: column;
            border-right: 1px solid #334155;
        }

        .sidebar-header { padding: 24px; border-bottom: 1px solid #334155; }
        .sidebar-header h1 { font-size: 1.25rem; margin: 0; display: flex; align-items: center; gap: 10px; color: var(--accent); }

        #file-tree { flex-grow: 1; overflow-y: auto; padding: 15px; }

        .folder-row { display: flex; align-items: center; padding: 8px 12px; cursor: pointer; border-radius: 6px; font-weight: 600; gap: 10px; }
        .folder-row:hover { background: var(--hover); }

        .file-row { display: flex; align-items: center; padding: 6px 12px; margin-left: 24px; cursor: pointer; border-radius: 6px; font-size: 0.9rem; color: var(--text-muted); gap: 10px; transition: 0.2s; }
        .file-row:hover { background: var(--hover); color: var(--accent); }
        .file-row.active { background: rgba(56, 189, 248, 0.1); color: var(--accent); }

        main { flex-grow: 1; display: flex; flex-direction: column; position: relative; }

        .audio-bar {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #334155;
            z-index: 10;
        }

        .now-playing-info { display: flex; flex-direction: column; max-width: 300px; }
        .now-playing-info small { color: var(--text-muted); font-size: 0.75rem; }
        .now-playing-info span { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        audio { height: 35px; width: 400px; filter: invert(100%) hue-rotate(180deg) brightness(1.5); }

        .viewer-container {
            flex-grow: 1;
            padding: 20px;
            background: #0f172a;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Views */
        #pdf-viewer, #image-viewer {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            background: white;
            display: none;
        }

        #image-viewer {
            object-fit: contain;
            background: #1e293b;
        }

        .show { display: block !important; }
        .hidden { display: none; }
        .rotate { transform: rotate(90deg); }
        .chevron { transition: transform 0.2s; width: 16px; height: 16px; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body>

<aside>
    <div class="sidebar-header">
        <h1><i data-lucide="graduation-cap"></i> Fran√ßais A1</h1>
        <h4>EMLV Paris 2025-26</h4>
    </div>
    <div id="file-tree"></div>
</aside>

<main>
    <div class="audio-bar">
        <div class="now-playing-info">
            <small>NOW LISTENING</small>
            <span id="current-title">Select an audio lesson</span>
        </div>
        <audio id="audio-player" controls></audio>
        <div style="width: 50px;"></div>
    </div>

    <div class="viewer-container">
        <!-- PDF View -->
        <iframe id="pdf-viewer" src="about:blank"></iframe>
        <!-- Image View -->
        <img id="image-viewer" src="" alt="Lesson Image">
    </div>
</main>

<script>
    // --- CONFIGURATION ---
const username = 'learning-french'; 
const repo = 'learning-french.github.io';     
const branch = 'main';             
// ---------------------

const extensions = {
    pdf: ['pdf'],
    image: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp'],
    audio: ['mp3', 'wav', 'ogg', 'm4a', 'wma']
};

async function fetchGitHubFiles(path = 'materials') {
    const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}?ref=${branch}`;
    const response = await fetch(url);
    const items = await response.json();
    
    let nodes = [];

    for (let item of items) {
        if (item.type === 'dir') {
            // It's a folder, get its children recursively
            const children = await fetchGitHubFiles(item.path);
            nodes.push({
                name: item.name,
                type: 'folder',
                children: children
            });
        } else {
            // It's a file
            nodes.push({
                name: item.name,
                type: 'file',
                path: item.download_url, // Direct link to the file on GitHub
                rawPath: item.path
            });
        }
    }
    return nodes;
}

async function init() {
    const treeContainer = document.getElementById('file-tree');
    treeContainer.innerHTML = 'Loading from GitHub...';
    
    try {
        const data = await fetchGitHubFiles(); // Starts scanning the 'materials' folder
        treeContainer.innerHTML = '';
        renderTree(data, treeContainer);
        lucide.createIcons();
    } catch (error) {
        treeContainer.innerHTML = 'Error loading files. Check username/repo name.';
        console.error(error);
    }
}

function getFileType(filename) {
    const ext = filename.split('.').pop().toLowerCase();
    if (extensions.pdf.includes(ext)) return 'pdf';
    if (extensions.image.includes(ext)) return 'image';
    if (extensions.audio.includes(ext)) return 'audio';
    return 'unknown';
}

function renderTree(nodes, parentElement) {
    // Sort folders first, then files
    nodes.sort((a, b) => (b.type === 'folder') - (a.type === 'folder'));

    nodes.forEach(node => {
        const container = document.createElement('div');
        container.className = 'tree-item';

        if (node.type === 'folder') {
            const row = document.createElement('div');
            row.className = 'folder-row';
            row.innerHTML = `<i data-lucide="chevron-right" class="chevron"></i><i data-lucide="folder" style="color: var(--accent); width:18px"></i><span>${node.name}</span>`;

            const childGroup = document.createElement('div');
            childGroup.className = 'hidden';
            row.onclick = () => {
                const isHidden = childGroup.classList.toggle('hidden');
                row.querySelector('.chevron').classList.toggle('rotate', !isHidden);
            };
            container.appendChild(row);
            container.appendChild(childGroup);
            renderTree(node.children, childGroup);
        } else {
            const type = getFileType(node.name);
            let icon = 'file';
            if (type === 'pdf') icon = 'file-text';
            if (type === 'image') icon = 'image';
            if (type === 'audio') icon = 'headphones';

            const row = document.createElement('div');
            row.className = 'file-row';
            row.innerHTML = `<i data-lucide="${icon}" style="width:16px"></i><span>${node.name}</span>`;
            row.onclick = () => {
                document.querySelectorAll('.file-row').forEach(r => r.classList.remove('active'));
                row.classList.add('active');
                openFile(node.path, node.name, type);
            };
            container.appendChild(row);
        }
        parentElement.appendChild(container);
    });
}

function openFile(path, name, type) {
    const pdfViewer = document.getElementById('pdf-viewer');
    const imgViewer = document.getElementById('image-viewer');
    const audioPlayer = document.getElementById('audio-player');

    pdfViewer.classList.remove('show');
    imgViewer.classList.remove('show');

    if (type === 'pdf') {
        // Use Google Docs viewer to bypass some PDF embed restrictions
        pdfViewer.src = `https://docs.google.com/viewer?url=${encodeURIComponent(path)}&embedded=true`;
        pdfViewer.classList.add('show');
    } 
    else if (type === 'image') {
        imgViewer.src = path;
        imgViewer.classList.add('show');
    } 
    else if (type === 'audio') {
        document.getElementById('current-title').innerText = name;
        audioPlayer.src = path;
        audioPlayer.play();
    }
}

init();
</script>
</body>
</html>